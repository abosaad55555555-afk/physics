<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> 
    
    <title>Snake.AI - Viral Ready Mobile Classic</title>
    
    <style>
        body {
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #38424a;
            color: #c0c0c0;
            margin: 0;
            padding: 10px;
            touch-action: none; /* Prevents default mobile scrolling when swiping */
        }

        header {
            max-width: 400px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        h1 {
            color: #00ff00;
            font-size: 2em;
            margin: 0;
            text-shadow: 0 0 5px #00ff00;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            border: 3px solid #00ff00;
            max-width: 95vw; /* Maximize space on mobile screens */
        }
        
        #gameCanvas {
            /* Ensures the canvas scales responsively within the container */
            width: 100%; 
            height: auto;
            background-color: #2e3a45;
            display: block;
        }

        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        .game-button {
            padding: 10px 20px;
            font-size: 1.1em;
            cursor: pointer;
            border: none;
            border-radius: 0;
            margin-top: 15px;
            text-transform: uppercase;
            font-weight: bold;
            background-color: #00ff00;
            color: black;
            transition: background-color 0.1s;
        }
        
        .game-button:hover, .game-button:active {
            background-color: #00cc00;
        }
        
        /* Style for the viral sharing button */
        #shareButton {
            background-color: #ff4500;
            color: white;
        }
        #shareButton:hover, #shareButton:active {
            background-color: #cc3700;
        }

        /* Instructions */
        #instructions {
            color: #00ff00;
            margin-top: 15px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <h1>Snake.AI</h1>
        <div id="score-container">Score: <span id="score">0</span></div>
    </header>

    <div id="game-container">
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        
        <div id="gameOverScreen" class="hidden">
            <h2>GAME OVER</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p id="viralMessage"></p>
            
            <button id="shareButton" class="game-button">SHARE HIGH SCORE!</button>

            <button id="retryButton" class="game-button">PLAY AGAIN</button>
        </div>
    </div>
    
    <p id="instructions">Use WASD/Arrows (Desktop) or Swipe (Mobile) to play.</p>

    <script>
        // --- Game Setup Variables ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreDisplay = document.getElementById('finalScore');
        const retryButton = document.getElementById('retryButton');
        const shareButton = document.getElementById('shareButton');
        const viralMessage = document.getElementById('viralMessage');

        // Game parameters
        const FIXED_WIDTH = 400; 
        const gridSize = 20;
        const tileCount = FIXED_WIDTH / gridSize;
        const gameSpeed = 10;
        let score = 0;
        let gameLoopInterval;

        // Snake and Control state
        let snake = [];
        let velocity = {};
        let nextVelocity = {};
        let food = {};

        // --- Touch Input Variables ---
        let touchStartX = 0;
        let touchStartY = 0;
        const SWIPE_THRESHOLD = 20;

        // --- Core Game Functions ---

        function startGame() {
            snake = [{ x: 10, y: 10 }];
            velocity = { x: 1, y: 0 };
            nextVelocity = { x: 1, y: 0 };
            score = 0;
            scoreDisplay.textContent = score;
            gameOverScreen.classList.add('hidden');
            
            placeFood();

            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 1000 / gameSpeed);
        }

        function gameLoop() {
            velocity = nextVelocity;
            
            if (checkCollision()) {
                gameOver();
                return;
            }

            const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };
            
            // Classic Wall Collision Check
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                 gameOver();
                 return;
            }

            snake.unshift(head);
            
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.textContent = score;
                placeFood(); 
            } else {
                snake.pop();
            }
            
            draw();
        }

        function draw() {
            ctx.fillStyle = '#2e3a45';
            ctx.fillRect(0, 0, FIXED_WIDTH, FIXED_WIDTH);
            
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 1, gridSize - 1);
            
            ctx.fillStyle = '#00ff00';
            snake.forEach(segment => {
                ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 1, gridSize - 1);
            });
        }

        function placeFood() {
            let newFoodPosition;
            do {
                newFoodPosition = {
                    x: Math.floor(Math.random() * tileCount),
                    y: Math.floor(Math.random() * tileCount)
                };
            } while (isFoodOnSnake(newFoodPosition));
            
            food = newFoodPosition;
        }

        function isFoodOnSnake(pos) {
            return snake.some(segment => segment.x === pos.x && segment.y === pos.y);
        }

        function checkCollision() {
            const head = snake[0];
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        // --- Game Over & Viral Sharing Logic ---

        function handleShareScore() {
            // FUTURE: In a real app, this converts the canvas to an image and uploads it.
            const shareText = `I just scored ${score} in the Classic Snake.AI game! Can you beat my score? Play now! [Your Game Link] #SnakeAI #ViralChallenge`;
            
            // Mock sharing action for web browser
            if (navigator.share) {
                // Uses the native mobile share dialog
                navigator.share({
                    title: 'Snake.AI High Score',
                    text: shareText,
                    url: window.location.href,
                }).catch(error => console.log('Error sharing', error));
            } else {
                // Fallback for desktop/browsers without native sharing
                alert("Share this: " + shareText);
            }
        }

        function gameOver() {
            clearInterval(gameLoopInterval);
            finalScoreDisplay.textContent = score;
            
            // Set the viral message based on score for high engagement
            if (score > 15) {
                viralMessage.textContent = "Incredible run! Only a few people reach that score. Share your triumph!";
            } else if (score > 5) {
                viralMessage.textContent = "Solid score! Challenge your friends to beat it.";
            } else {
                 viralMessage.textContent = "Nice try! Play again or share your attempt.";
            }
            
            gameOverScreen.classList.remove('hidden');
        }

        // --- Input Handling ---

        // 1. Keyboard Input
        document.addEventListener('keydown', e => {
            if ((e.key === 'ArrowUp' || e.key === 'w') && velocity.y === 0) {
                nextVelocity = { x: 0, y: -1 };
            } else if ((e.key === 'ArrowDown' || e.key === 's') && velocity.y === 0) {
                nextVelocity = { x: 0, y: 1 };
            } else if ((e.key === 'ArrowLeft' || e.key === 'a') && velocity.x === 0) {
                nextVelocity = { x: -1, y: 0 };
            } else if ((e.key === 'ArrowRight' || e.key === 'd') && velocity.x === 0) {
                nextVelocity = { x: 1, y: 0 };
            }
        });

        // 2. Touch Input
        canvas.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        }, false);

        canvas.addEventListener('touchend', e => {
            if (e.changedTouches.length === 0) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;

            const dx = touchEndX - touchStartX;
            const dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > SWIPE_THRESHOLD) {
                // Horizontal swipe
                if (dx > 0 && velocity.x === 0) {
                    nextVelocity = { x: 1, y: 0 };
                } else if (dx < 0 && velocity.x === 0) {
                    nextVelocity = { x: -1, y: 0 };
                }
            } else if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > SWIPE_THRESHOLD) {
                // Vertical swipe
                if (dy > 0 && velocity.y === 0) {
                    nextVelocity = { x: 0, y: 1 };
                } else if (dy < 0 && velocity.y === 0) {
                    nextVelocity = { x: 0, y: -1 };
                }
            }
            e.preventDefault();
        }, false);


        // --- Initializer ---

        retryButton.addEventListener('click', startGame);
        shareButton.addEventListener('click', handleShareScore);

        // Start the game immediately on load
        startGame();
    </script>
</body>
</html>